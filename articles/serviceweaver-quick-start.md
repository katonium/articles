---
title: ""
emoji: "ğŸ‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: false
---

## ã¯ã˜ã‚ã«

Googleã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒé–‹ç™ºã—ãŸã€ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ¢ãƒãƒªã‚·ãƒƒã‚¯ã«æ§‹ç¯‰ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ãŒå¯èƒ½ãªServiceWeaverã¨ã„ã†ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚
æœ¬è¨˜äº‹ã§ã¯ServiceWeaverã®ç‰¹å¾´ã‚’å‹•ã‹ã—ãªãŒã‚‰ãã®ç‰¹å¾´ã‚’å®Ÿéš›ã«ç†è§£ã—ã¦ã„ãã¾ã™ã€‚

https://serviceweaver.dev/

## ServiceWeaverã®ç‰¹å¾´

è©³ç´°ã¯åˆ¥è¨˜äº‹ã§åˆ¥é€”è§£èª¬äºˆå®šã§ã™ãŒã€ä¸‹è¨˜ã®ç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã€‚
ãƒãƒ¼ã‚¸ãƒ§ãƒ³é–“ã®é€šä¿¡ã‚„è¤‡æ•°ã®ãƒã‚¤ãƒŠãƒªç®¡ç†ã¨ã„ã£ãŸãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã®é‹ç”¨ã§é›£ã—ã„éƒ¨åˆ†ã‚’å¿…è¦ã¨ã—ãªã„ä»•çµ„ã¿ã‚’å°å…¥ã™ã‚‹ã“ã¨ã§ã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã®é–‹ç™ºãƒ»é‹ç”¨ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«å®Ÿç¾ã™ã‚‹ã“ã¨ã‚’ç‹™ã£ãŸãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ãªã‚Šã¾ã™ã€‚

1. é–‹ç™ºæ™‚ã«ã¯è«–ç†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã•ã‚ŒãŸãƒ¢ãƒãƒªã‚·ãƒƒã‚¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚‹ã“ã¨ã€‚
2. å®Ÿè¡Œæ™‚ã«è«–ç†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«è‡ªå‹•ã‹ã¤å‹•çš„ã«ç‰©ç†ãƒ—ãƒ­ã‚»ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ã€‚
3. ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒç•°ãªã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“ã§é€šä¿¡ã—ãªã„"ã‚¢ãƒˆãƒŸãƒƒã‚¯ãªãƒ‡ãƒ—ãƒ­ã‚¤"ã‚’ã™ã‚‹ã“ã¨ã€‚

:::message
è¨˜äº‹åŸ·ç­†æ™‚ç‚¹(2024/3/19)ã§ã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯0.23.0ã§ã‚ã‚Šã€ã¾ãŸå®‰å®šç‰ˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ä»Šå¾Œç ´å£Šçš„ãªå¤‰æ›´ãŒå…¥ã‚‹ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ãŸã‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«çµ„ã¿è¾¼ã‚€éš›ã«ã¯æ…é‡ãªåˆ¤æ–­ãŒå¿…è¦ã§ã‚ã‚‹ã“ã¨ã‚’ã”ç†è§£ãã ã•ã„ã€‚
:::

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
GoãŒå‹•ãç’°å¢ƒã‚’å‰æã¨ã—ã¦è©±ã‚’é€²ã‚ã¾ã™ã€‚Goã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯[ã“ã¡ã‚‰](https://go.dev/doc/install)ã‹ã‚‰ã€‚

Service Weaver CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```
go install github.com/ServiceWeaver/weaver/cmd/weaver@latest
```

Kubernetesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã«ã¯åˆ¥é€”`weaver-gke`ã‚‚ã—ãã¯`weaver-kube`ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚
```
# å…¨è‡ªå‹•ã§GKEã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã„å ´åˆ
go install github.com/ServiceWeaver/weaver-gke/cmd/weaver-gke@latest
# ãã‚Œä»¥å¤–ã®æ‰‹æ³•ã§Kubernetesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã„å ´åˆ
go install github.com/ServiceWeaver/weaver-kube/cmd/weaver-kube@latest
```

ã“ã®ã‚ã¨å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãã®ã§ã€`hello/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—åˆæœŸåŒ–ã—ã¦ãŠãã¾ã™ã€‚

```bash
mkdir hello/
cd hello/
go mod init hello
```

## ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•

ServiceWeaberã®ç‰¹å¾´ã¨ã—ã¦ã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã«ãŠã‘ã‚‹å„ã‚µãƒ¼ãƒ“ã‚¹ã®å˜ä½ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨å‘¼ã°ã‚Œã‚‹æ§‹é€ ä½“ã«ã‚ˆã£ã¦å®šç¾©ã—ã¾ã™ã€‚
æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªServiceWeaberã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚`app`ã¨å‘¼ã°ã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã¿ã®æ§‹æˆã§ã™ã€‚

```go:main.go
package main

import (
    "context"
    "fmt"
    "log"

    "github.com/ServiceWeaver/weaver"
)

func main() {
    if err := weaver.Run(context.Background(), serve); err != nil {
        log.Fatal(err)
    }
}

// app - ãƒ¡ã‚¤ãƒ³ã¨ãªã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®šç¾©ã§ã™ã€‚ServiceWeaverã¯ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå˜ä½ã«ç‰©ç†ãƒ—ãƒ­ã‚»ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã¾ã™ã€‚
type app struct{
    weaver.Implements[weaver.Main]
}

// serveã¯weaver.Runã«ã‚ˆã£ã¦å‘¼ã³å‡ºã•ã‚Œã‚‹ãƒ¡ã‚¤ãƒ³å‡¦ç†ã§ã™ã€‚å¼•æ•°ã¨ãªã‚‹appæ§‹é€ ä½“ã¯ServiceWeaberã«ã‚ˆã£ã¦æ³¨å…¥ã•ã‚Œã¾ã™ã€‚
func serve(context.Context, *app) error {
    fmt.Println("Hello")
    return nil
}
```

ä¸Šè¨˜ã®`main.go`ã‚’ä½œæˆã—ãŸ`hello/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«é…ç½®ã—ã€ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã«ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã™ã‚‹ã¨ã€"Hello"ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
```bash
go mod tidy
weaver generate .
go run .
# -> Hello
```

## è¤‡æ•°ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ãªã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•

æ¬¡ã«ã€è¤‡æ•°ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ãªã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¾ã™ã€‚`reverser.go`ã‚’ä½œæˆã—`Reverser`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®šç¾©ã—ã¾ã™ã€‚

```go:reverser.go
package main

import (
    "context"

    "github.com/ServiceWeaver/weaver"
)

// Reverser - Reverserã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ç¤ºã™ã€‚
type Reverser interface {
    Reverse(context.Context, string) (string, error)
}

// reverser - Reverser componentã®interfaceã‚’æº€ãŸã™å®Ÿè£…ã€‚èµ·å‹•æ™‚ã«æ³¨å…¥ã•ã‚Œã‚‹ã€‚
type reverser struct{
    weaver.Implements[Reverser]
}

// Reverse - ä¸ãˆã‚‰ã‚ŒãŸæ–‡å­—ã‚’åå¯¾ã«ã—ã¦è¿”ã™
func (r *reverser) Reverse(_ context.Context, s string) (string, error) {
    runes := []rune(s)
    n := len(runes)
    for i := 0; i < n/2; i++ {
        runes[i], runes[n-i-1] = runes[n-i-1], runes[i]
    }
    return string(runes), nil
}

```

`main.go`ã‚‚ä¸‹è¨˜ã®é€šã‚Šä¿®æ­£ã—ã€`Reverser`ã‚’å‘¼ã³å‡ºã™ã‚ˆã†ã«ã—ã¾ã™ã€‚

```go:main.go
package main

import (
    "context"
    "fmt"
    "log"

    "github.com/ServiceWeaver/weaver"
)

func main() {
    if err := weaver.Run(context.Background(), serve); err != nil {
        log.Fatal(err)
    }
}

type app struct{
    weaver.Implements[weaver.Main]
    reverser weaver.Ref[Reverser] // Reverserã¸ã®å‚ç…§ã‚’å®šç¾©
}

// serve - ServiceWeaberãŒèµ·å‹•ã™ã‚‹å‡¦ç†ã€‚app, Reverserã¯èµ·å‹•æ™‚ã«æ³¨å…¥ã•ã‚Œã‚‹ã€‚
func serve(ctx context.Context, app *app) error {
    // Reverseã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‘¼ã³å‡ºã—ã¦æ–‡å­—åˆ—ã®é †åºã‚’é€†è»¢ã•ã›ã‚‹
    var r Reverser = app.reverser.Get()
    reversed, err := r.Reverse(ctx, "!dlroW ,olleH")
    if err != nil {
        return err
    }
    fmt.Println(reversed)
    return nil
}
```

- APIå®šç¾©ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ã«ã€APIå‘¼ã³å‡ºã—ãŒé–¢æ•°å‘¼ã³å‡ºã—ã«ãªã£ã¦ã„ã‚‹ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ç”¨ã®Yamlã‚’ä½œã‚‹ç­‰ã¨æ¯”è¼ƒã—ã€éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…ã¨ãªã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã€‚


ã¨ã‚Šã‚ãˆãšã€ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã‚‚ã‚‰ã†ã®ãŒè‰¯ã„ã‹ã¨æ€ã†ã®ã§å®Œæˆå“ã®ã‚³ãƒ¼ãƒ‰ã‚’ç¤ºã—ã¾ã™ã€‚
ä½œæˆã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯Service Weaverã®[Step by Step Tutorial](https://serviceweaver.dev/docs.html#step-by-step-tutorial)ã¨åŒã˜ãä¸‹è¨˜ã®æ§‹æˆã‚’ã¨ã‚Šã¾ã™ã€‚ã“ã“ã¾ã§ã«è‡³ã‚‹ã¾ã§ã¯æœ¬å®¶ã®[Step by Step Tutorial](https://serviceweaver.dev/docs.html#step-by-step-tutorial)ã§å°‘ã—ãšã¤ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã—ãªãŒã‚‰è§£èª¬ã—ã¦ã„ã¾ã™ã®ã§ãã¡ã‚‰ã‚’ã”å‚ç…§ãã ã•ã„ã€‚



ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨å‘¼ã°ã‚Œã‚‹å˜ä½ãŒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã‘ã‚‹å€‹ã€…ã®ã‚µãƒ¼ãƒ“ã‚¹å˜ä½ã¨ãªã‚Šã¾ã™ã€‚





